(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      8985,        248]
NotebookOptionsPosition[      7323,        217]
NotebookOutlinePosition[      7665,        232]
CellTagsIndexPosition[      7622,        229]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{"net", "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"<|", 
     RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Softmax\>\""}], "|>"}], ",", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], ",", 
      RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
       RowBox[{"<|", 
        RowBox[{"\"\<Weights\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1", ",", "5", ",", "6"}], "}"}]}], "|>"}]}]}], "|>"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.739229842962337*^9, 3.739229924041678*^9}, {
  3.7392302487097397`*^9, 3.739230273979878*^9}, {3.739230452943368*^9, 
  3.7392304620214853`*^9}, {3.739234283963745*^9, 3.7392342843447123`*^9}, {
  3.739234522442684*^9, 
  3.7392345241092234`*^9}},ExpressionUUID->"ed9aac8d-2a98-4de2-8077-\
50d136f16962"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"\[LeftAssociation]", 
    RowBox[{"\<\"LayerType\"\>", "\[Rule]", "\<\"Softmax\"\>"}], 
    "\[RightAssociation]"}], ",", 
   RowBox[{"\[LeftAssociation]", 
    RowBox[{
     RowBox[{"\<\"LayerType\"\>", "\[Rule]", "\<\"LinearLayer\"\>"}], ",", 
     RowBox[{"\<\"Parameters\"\>", "\[Rule]", 
      RowBox[{"\[LeftAssociation]", 
       RowBox[{"\<\"Weights\"\>", "\[Rule]", 
        RowBox[{"{", "}"}]}], "\[RightAssociation]"}]}]}], 
    "\[RightAssociation]"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.739230254967615*^9, 3.739230274721499*^9}, 
   3.7392343001194954`*^9},
 CellLabel->
  "Out[158]=",ExpressionUUID->"97db5fd5-a5f1-4331-b506-4986a2073679"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"netEval", "[", 
   RowBox[{"net", ",", "x"}], "]"}], "\[Rule]", "output"}]], "Input",
 CellChangeTimes->{{3.739229942624263*^9, 3.7392299443947372`*^9}, {
  3.739229975211225*^9, 
  3.739229990963319*^9}},ExpressionUUID->"2dbf051b-6794-4698-8118-\
162650303536"],

Cell[BoxData[
 RowBox[{
  RowBox[{"layerEval", "[", 
   RowBox[{"x_", ",", "layer_Association"}], "]"}], ":=", 
  RowBox[{"layerEval", "[", 
   RowBox[{"x", ",", 
    RowBox[{"Lookup", "[", 
     RowBox[{"layer", ",", "\"\<LayerType\>\""}], "]"}], ",", 
    RowBox[{"Lookup", "[", 
     RowBox[{"layer", ",", "\"\<Parameters\>\""}], "]"}]}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.739230048096012*^9, 3.739230126331902*^9}, {
  3.7392303998589163`*^9, 3.7392304087510443`*^9}, {3.739233146376992*^9, 
  3.739233146687701*^9}},ExpressionUUID->"d57d0057-fe9a-4da0-9f04-\
120c71ce74a7"],

Cell["Layer Definitions", "Item",
 CellChangeTimes->{{3.739230512517234*^9, 
  3.739230517821245*^9}},ExpressionUUID->"b56e90d2-1c5d-4473-8b05-\
17413a12a660"],

Cell[BoxData[
 RowBox[{
  RowBox[{"layerEval", "[", 
   RowBox[{"x_", ",", "\"\<Softmax\>\"", ",", "_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"SoftmaxLayer", "[", "]"}], "[", "x", "]"}]}]], "Input",
 CellChangeTimes->{{3.739230137133313*^9, 3.7392301547717657`*^9}, {
  3.739230239695559*^9, 3.7392302423574457`*^9}, {3.7392304265585127`*^9, 
  3.739230429391158*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"acb2f457-f421-42d4-8830-3e4963faaf61"],

Cell[BoxData[
 RowBox[{
  RowBox[{"layerEval", "[", 
   RowBox[{"x_", ",", "\"\<Ramp\>\"", ",", "_"}], "]"}], ":=", 
  RowBox[{"Ramp", "[", "x", "]"}]}]], "Input",
 CellChangeTimes->{{3.739230431911519*^9, 
  3.739230434709384*^9}},ExpressionUUID->"abdfd562-ad5d-4eb0-951c-\
8eafa6924402"],

Cell[BoxData[
 RowBox[{
  RowBox[{"layerEval", "[", 
   RowBox[{"x_", ",", "\"\<LinearLayer\>\"", ",", "param_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Dot", "[", 
    RowBox[{"x", ",", 
     RowBox[{"param", "[", "\"\<Weights\>\"", "]"}]}], "]"}], "+", 
   RowBox[{"param", "[", "\"\<Biases\>\"", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.739230437967194*^9, 
  3.7392304954295473`*^9}},ExpressionUUID->"20ace5f3-c91b-4613-89ef-\
827d827ac0d1"],

Cell["Evaluator", "Item",
 CellChangeTimes->{{3.73923052312189*^9, 
  3.739230525132897*^9}},ExpressionUUID->"e9160ad1-42b4-4836-8a14-\
2a7090eabea3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"netEvaluate", "[", 
   RowBox[{"net_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{"layerEval", ",", "x", ",", "net"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"netEvaluate", "[", 
   RowBox[{"net_", ",", "x_", ",", "\"\<Training\>\""}], "]"}], ":=", 
  RowBox[{"FoldList", "[", 
   RowBox[{"layerEval", ",", "x", ",", "net"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.739230175331674*^9, 3.739230235753093*^9}, {
  3.739230370543332*^9, 3.739230380413294*^9}, {3.739231018286749*^9, 
  3.739231046925303*^9}},ExpressionUUID->"0d14c289-5af1-4794-b1e4-\
8127b6b829cf"],

Cell["Backpass", "Item",
 CellChangeTimes->{{3.73923052312189*^9, 
  3.7392305371255703`*^9}},ExpressionUUID->"cfbb2f93-258d-4f8c-b0db-\
bb3f6a7d31fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"netD", "[", 
   RowBox[{"x_", ",", "y_", ",", "net_", ",", "loss_"}], "]"}], "\[Rule]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"<|", 
     RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Softmax\>\""}], "|>"}], ",", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], ",", 
      RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<Weights\>\"", "\[Rule]", 
          RowBox[{"{", "}"}]}], ",", ".."}], "|>"}]}]}], "|>"}]}], 
   "}"}]}]], "Input",
 CellChangeTimes->{{3.739230545228664*^9, 3.739230573189672*^9}, {
   3.739230608088087*^9, 3.739230614552938*^9}, 
   3.739230668051812*^9},ExpressionUUID->"2d8380fd-307a-4dee-9876-\
a4e01f596aad"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"MapThread", "[", 
   RowBox[{"updater", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"l1", ",", "l2", ",", "l3"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"g1", ",", "g2", ",", "g3"}], "}"}]}], "}"}]}], "]"}], 
  "\[Rule]", " ", 
  RowBox[{"new", " ", "net"}]}]], "Input",
 CellChangeTimes->{{3.739230707317945*^9, 
  3.739230767316691*^9}},ExpressionUUID->"8f97cd7e-a668-416a-8e15-\
c8b38fa1f560"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"f", "[", 
    RowBox[{"1", ",", "4"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"2", ",", "6"}], "]"}], ",", 
   RowBox[{"f", "[", 
    RowBox[{"3", ",", "3"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.739230719596405*^9},
 CellLabel->"Out[10]=",ExpressionUUID->"dfbb809c-17d6-4b07-8014-c45184426ac3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"x", "=", 
  RowBox[{"<|", 
   RowBox[{
    RowBox[{"\"\<Input\>\"", "\[Rule]", "..."}], ",", 
    RowBox[{"\"\<Target\>\"", "\[Rule]", "..."}]}], "|>"}]}]], "Input",
 CellChangeTimes->{{3.7392306216237593`*^9, 
  3.739230629745125*^9}},ExpressionUUID->"cb221f5c-69a2-4b75-b7c8-\
93dd136b9e11"]
},
WindowSize->{958, 1028},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 7, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 838, 20, 28, "Input",ExpressionUUID->"ed9aac8d-2a98-4de2-8077-50d136f16962"],
Cell[1421, 44, 713, 17, 32, "Output",ExpressionUUID->"97db5fd5-a5f1-4331-b506-4986a2073679"]
}, Open  ]],
Cell[2149, 64, 297, 7, 28, "Input",ExpressionUUID->"2dbf051b-6794-4698-8118-162650303536"],
Cell[2449, 73, 587, 14, 28, "Input",ExpressionUUID->"d57d0057-fe9a-4da0-9f04-120c71ce74a7"],
Cell[3039, 89, 159, 3, 31, "Item",ExpressionUUID->"b56e90d2-1c5d-4473-8b05-17413a12a660"],
Cell[3201, 94, 446, 9, 28, "Input",ExpressionUUID->"acb2f457-f421-42d4-8830-3e4963faaf61"],
Cell[3650, 105, 289, 7, 28, "Input",ExpressionUUID->"abdfd562-ad5d-4eb0-951c-8eafa6924402"],
Cell[3942, 114, 446, 11, 28, "Input",ExpressionUUID->"20ace5f3-c91b-4613-89ef-827d827ac0d1"],
Cell[4391, 127, 150, 3, 31, "Item",ExpressionUUID->"e9160ad1-42b4-4836-8a14-2a7090eabea3"],
Cell[4544, 132, 639, 15, 48, "Input",ExpressionUUID->"0d14c289-5af1-4794-b1e4-8127b6b829cf"],
Cell[5186, 149, 151, 3, 31, "Item",ExpressionUUID->"cfbb2f93-258d-4f8c-b0db-bb3f6a7d31fe"],
Cell[5340, 154, 784, 20, 48, "Input",ExpressionUUID->"2d8380fd-307a-4dee-9876-a4e01f596aad"],
Cell[CellGroupData[{
Cell[6149, 178, 469, 14, 28, "Input",ExpressionUUID->"8f97cd7e-a668-416a-8e15-c8b38fa1f560"],
Cell[6621, 194, 366, 10, 32, "Output",ExpressionUUID->"dfbb809c-17d6-4b07-8014-c45184426ac3"]
}, Open  ]],
Cell[7002, 207, 317, 8, 28, "Input",ExpressionUUID->"cb221f5c-69a2-4b75-b7c8-93dd136b9e11"]
}
]
*)


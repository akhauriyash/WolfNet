(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     23758,        590]
NotebookOptionsPosition[     22031,        557]
NotebookOutlinePosition[     22378,        572]
CellTagsIndexPosition[     22335,        569]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"prepareData", "[", "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tx", ",", " ", "tt", ",", " ", "ty", ",", " ", "i"}], "}"}], 
     ",", " ", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"training", " ", "=", " ", 
       RowBox[{"RandomSample", "[", 
        RowBox[{"ExampleData", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<MachineLearning\>\"", ",", "\"\<MNIST\>\""}], "}"}], 
          ",", "\"\<TrainingData\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tx", " ", "=", " ", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"ImageData", ",", " ", 
           RowBox[{"training", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"60000", ",", " ", "784"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tt", "  ", "=", " ", 
       RowBox[{"training", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ty", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", " ", 
         RowBox[{"{", 
          RowBox[{"60000", ",", " ", "10"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", "60000"}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ty", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", " ", 
             RowBox[{"1", "+", 
              RowBox[{"tt", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], "]"}], " ", "=", 
          " ", "1"}], ";"}]}], "]"}], ";", " ", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"tx", ",", " ", "ty"}], "}"}], "]"}], ";"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.739233148086295*^9, 3.739233190809897*^9}, {
   3.739233320772684*^9, 3.739233354574588*^9}, {3.73923340938995*^9, 
   3.739233433527355*^9}, 3.739233982125271*^9, {3.7392347358936076`*^9, 
   3.739234736025262*^9}, {3.7392385254695683`*^9, 3.7392385396287127`*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"7829bba4-9f62-4f5f-b7cb-a2e4b0bba986"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"initializeWeights", "[", 
     RowBox[{"hiddennodes_", ",", " ", "outputnodes_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "mininet", ",", " ", "netinit", ",", " ", "w0", ",", " ", "w1"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mininet", " ", "=", " ", 
        RowBox[{"NetChain", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"LinearLayer", "[", "hiddennodes", "]"}], ",", " ", 
            "Ramp", ",", " ", 
            RowBox[{"LinearLayer", "[", "outputnodes", "]"}], ",", " ", 
            "LogisticSigmoid"}], "}"}], ",", " ", 
          RowBox[{"\"\<Input\>\"", "\[Rule]", "784"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"netinit", " ", "=", " ", 
        RowBox[{"NetInitialize", "[", 
         RowBox[{"mininet", ",", " ", 
          RowBox[{"Method", " ", "\[Rule]", 
           RowBox[{"{", "\"\<Xavier\>\"", "}"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w0", " ", "=", " ", 
        RowBox[{"Transpose", "@", 
         RowBox[{
          RowBox[{"NetExtract", "[", 
           RowBox[{"netinit", ",", " ", 
            RowBox[{"{", 
             RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], 
          "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"w1", " ", "=", " ", 
        RowBox[{"Transpose", "@", 
         RowBox[{
          RowBox[{"NetExtract", "[", 
           RowBox[{"netinit", ",", " ", 
            RowBox[{"{", 
             RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], 
          "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"w0", ",", " ", "w1"}], "}"}], "]"}], ";"}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.739233449602352*^9, 3.7392334601032667`*^9}, {
   3.739233502199691*^9, 3.739233505746063*^9}, {3.7392339491076083`*^9, 
   3.739233979293847*^9}, {3.739234048255398*^9, 3.739234049121029*^9}, {
   3.739234673211311*^9, 3.7392347839201155`*^9}, 3.7392362495112953`*^9, 
   3.7392366246902523`*^9, {3.739238593796336*^9, 3.7392385976430464`*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"9a01a0fc-7e26-4087-a77e-a5c55034816b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"learningrate", " ", "=", " ", "0.001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hiddennodes", " ", "=", " ", "512"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputnodes", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"batchsize", " ", "=", " ", "32"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iterations", " ", "=", " ", 
   RowBox[{"Floor", "[", 
    RowBox[{"60000", "/", "batchsize"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epochs", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b1", " ", "=", " ", "0.9"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b2", " ", "=", " ", "0.99"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsilon", " ", "=", " ", "0.00000001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inputdim", "  ", "=", " ", "784"}], ";"}]}], "Input",
 CellLabel->"In[44]:=",ExpressionUUID->"77c19d7a-ce8d-427d-81f6-6fcb70a24b02"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sigmDeriv", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"x", "*", 
     RowBox[{"(", 
      RowBox[{"1", "-", "x"}], ")"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rampDeriv", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"UnitStep", "[", "x", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.739238147417404*^9, 3.7392381927251434`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"77d270d1-b953-461c-9bad-eb44c7207587"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"layerEval", "[", 
   RowBox[{"x_", ",", " ", "layer_Association"}], "]"}], ":=", 
  RowBox[{"layerEval", "[", 
   RowBox[{"x", ",", " ", 
    RowBox[{"Lookup", "[", 
     RowBox[{"layer", ",", " ", "\"\<LayerType\>\""}], "]"}], ",", " ", 
    RowBox[{"Lookup", "[", 
     RowBox[{"layer", ",", "\"\<Parameters\>\""}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "\"\<Sigmoid\>\""}], "]"}], ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"1", "/", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", "x"}], "]"}]}], ")"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", 
    RowBox[{"x_", ",", " ", "\"\<Ramp\>\""}], "]"}], " ", ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{
     RowBox[{"Abs", "[", "x", "]"}], "*", 
     RowBox[{"UnitStep", "[", "x", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"layerEval", "[", " ", 
    RowBox[{"x_", ",", " ", "\"\<LinearLayer\>\"", ",", " ", "param_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Return", "[", 
    RowBox[{"Dot", "[", 
     RowBox[{"x", ",", " ", 
      RowBox[{"param", "[", "\"\<Weights\>\"", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"netEvaluate", "[", 
    RowBox[{"net_", ",", " ", "x_", ",", " ", "\"\<Training\>\""}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"FoldList", "[", 
    RowBox[{"layerEval", ",", " ", "x", ",", " ", "net"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7392349576463532`*^9, 3.739235053134879*^9}, {
   3.739235191661913*^9, 3.7392352248631043`*^9}, {3.7392356316641345`*^9, 
   3.739235634991685*^9}, 3.739236330471072*^9, {3.739238808971236*^9, 
   3.739238809445966*^9}},
 CellLabel->"In[56]:=",ExpressionUUID->"57345bbf-7009-4430-990a-36c88888c09e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"backProp", "[", 
   RowBox[{
   "fullnet_", ",", " ", "w0_", ",", " ", "w1_", ",", " ", "input_", ",", " ",
     "target_", ",", "  ", "l2M_", ",", " ", "l1M_", ",", " ", "l2V_", ",", 
    " ", "l1V_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "l2Error", ",", " ", "l2Delta", ",", " ", "l1Error", ",", " ", "l1Delta",
       ",", " ", "g1", ",", " ", "g0", ",", " ", "l0", ",", " ", "l1", ",", 
      " ", "l2", ",", " ", "l1MC", ",", " ", "l1VC", ",", " ", "l2MC", ",", 
      " ", "l2VC", ",", " ", "w1UDT", ",", " ", "w0UDT"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"l2Error", " ", "=", " ", 
      RowBox[{
       RowBox[{"fullnet", "[", 
        RowBox[{"[", 
         RowBox[{"-", "1"}], "]"}], "]"}], " ", "-", " ", "target"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l2Delta", " ", "=", " ", 
      RowBox[{"l2Error", "*", 
       RowBox[{"sigmDeriv", "[", 
        RowBox[{"fullnet", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l1Error", " ", "=", 
      RowBox[{"l2Delta", ".", 
       RowBox[{"Transpose", "[", 
        RowBox[{"fullnet", "[", "w1", "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l1Delta", " ", "=", " ", 
      RowBox[{"l1Error", "*", 
       RowBox[{"rampDeriv", "[", 
        RowBox[{"fullnet", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"g1", " ", "=", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{
         RowBox[{"fullnet", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", " ", "l2Delta"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"g0", " ", "=", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", "input", "]"}], ",", " ", "l1Delta"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"l2M", " ", "=", " ", 
      RowBox[{
       RowBox[{"l2M", "*", "b1"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "b1"}], ")"}], "*", "g1"}]}]}], ";", 
     RowBox[{"l1M", " ", "=", " ", 
      RowBox[{
       RowBox[{"l1M", "*", "b2"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "b2"}], ")"}], "*", "g0"}]}]}], ";", 
     "\t\t\t\t\t\t", "\[IndentingNewLine]", 
     RowBox[{"l2V", " ", "=", " ", 
      RowBox[{
       RowBox[{"l2V", "*", "b2"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "b2"}], ")"}], "*", 
        RowBox[{"(", 
         RowBox[{"g1", "*", "g1"}], ")"}]}]}]}], ";", 
     "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", 
     RowBox[{"l1V", " ", "=", " ", 
      RowBox[{
       RowBox[{"l1V", "*", "b1"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "b1"}], ")"}], "*", 
        RowBox[{"(", 
         RowBox[{"g0", "*", "g0"}], ")"}]}]}]}], ";", 
     "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", 
     RowBox[{"l1MC", " ", "=", " ", 
      RowBox[{"l1M", "/", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", " ", 
     RowBox[{"l1VC", " ", "=", " ", 
      RowBox[{"l1V", "/", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", "\t\t\t\t\t\t\t\t\t\t\t",
      "\[IndentingNewLine]", 
     RowBox[{"l2MC", " ", "=", " ", 
      RowBox[{"l2M", "/", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", " ", 
     RowBox[{"l2VC", " ", "=", " ", 
      RowBox[{"l2V", "/", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"w1UDT", " ", "=", 
      RowBox[{"l2MC", "/", 
       RowBox[{"(", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"l2VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";", 
     "\t\t\t\t\t\t\t\t\t\t\t\t", 
     RowBox[{"w0UDT", " ", "=", " ", 
      RowBox[{"l1MC", "/", 
       RowBox[{"(", 
        RowBox[{"Sqrt", "[", 
         RowBox[{"l1VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";", 
     "\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", 
     RowBox[{"w1", " ", "-=", " ", 
      RowBox[{"learningrate", "*", "w1UDT"}]}], ";", 
     "\t\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", 
     RowBox[{"w0", " ", "-=", " ", 
      RowBox[{"learningrate", "*", "w0UDT"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"w0", ",", " ", "w1"}], "}"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7392376689147177`*^9, 3.739237722262997*^9}, {
  3.7392377653636723`*^9, 3.7392378077757096`*^9}, {3.739238020527505*^9, 
  3.7392381703021355`*^9}, {3.7392382031452656`*^9, 3.7392382323061686`*^9}, {
  3.7392382653208513`*^9, 3.7392383310061026`*^9}, {3.7392383703351154`*^9, 
  3.7392383734108877`*^9}, {3.7392384784967346`*^9, 3.739238479541937*^9}, {
  3.739238777573239*^9, 3.7392387942605934`*^9}, {3.739238829341736*^9, 
  3.7392388346315875`*^9}, {3.7392390969168744`*^9, 3.7392390983450537`*^9}, {
  3.7392393092933855`*^9, 3.7392393314266148`*^9}, {3.739239760649568*^9, 
  3.739239761157754*^9}, {3.739241116825941*^9, 3.7392411625527315`*^9}, {
  3.7392412164505405`*^9, 3.7392412177188473`*^9}, {3.739241251270969*^9, 
  3.7392413065848603`*^9}, {3.7392415380066566`*^9, 3.73924154443721*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"0b01139e-8fc6-46c6-a8b0-a48450a9a150"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"runNet", "[", 
    RowBox[{"input_", ",", " ", "target_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "iteration", ",", " ", "fullnet", ",", " ", "w0", ",", " ", "w1", ",", 
       " ", "l2M", ",", " ", "l1M", ",", " ", "l2V", ",", " ", "l1V"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"w0", ",", " ", "w1"}], "}"}], " ", "=", " ", 
       RowBox[{"initializeWeights", "[", 
        RowBox[{"512", ",", " ", "10"}], "]"}]}], ";", 
      RowBox[{"net", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], 
           ",", 
           RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
            RowBox[{"<|", 
             RowBox[{"\"\<Weights\>\"", "\[Rule]", "w0"}], "|>"}]}]}], "|>"}],
          ",", " ", 
         RowBox[{"<|", 
          RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}], 
         ",", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}], 
           ",", 
           RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
            RowBox[{"<|", 
             RowBox[{"\"\<Weights\>\"", "\[Rule]", "w1"}], "|>"}]}]}], "|>"}],
          ",", " ", 
         RowBox[{"<|", 
          RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Sigmoid\>\""}], 
          "|>"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"l2M", " ", "=", " ", "0"}], ";", " ", 
      RowBox[{"l1M", " ", "=", " ", "0"}], ";", " ", 
      RowBox[{"l2V", " ", "=", " ", "0"}], ";", " ", 
      RowBox[{"l1V", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"iteration", " ", "=", " ", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", "iterations"}], ",", " ", 
        RowBox[{"i", "+=", "batchsize"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", "iteration", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullnet", " ", "=", " ", 
          RowBox[{"netEvaluate", "[", 
           RowBox[{"net", ",", " ", 
            RowBox[{"input", "[", 
             RowBox[{"[", 
              RowBox[{"iteration", ";;", 
               RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
            " ", "\"\<Training\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"w0", ",", " ", "w1"}], "}"}], " ", "=", " ", 
          RowBox[{"backProp", "[", 
           RowBox[{"fullnet", ",", "w0", ",", " ", "w1", ",", " ", 
            RowBox[{"input", "[", 
             RowBox[{"[", 
              RowBox[{"iteration", ";;", 
               RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
            "  ", 
            RowBox[{"target", "[", 
             RowBox[{"[", 
              RowBox[{"iteration", ";;", 
               RowBox[{"iteration", "+", "batchsize"}]}], "]"}], "]"}], ",", 
            " ", "l2M", ",", " ", "l1M", ",", " ", "l2V", ",", " ", "l1V"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"net", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}],
               ",", 
              RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
               RowBox[{"<|", 
                RowBox[{"\"\<Weights\>\"", "\[Rule]", "w0"}], "|>"}]}]}], 
             "|>"}], ",", " ", 
            RowBox[{"<|", 
             RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Ramp\>\""}], "|>"}],
             ",", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<LinearLayer\>\""}],
               ",", 
              RowBox[{"\"\<Parameters\>\"", "\[Rule]", 
               RowBox[{"<|", 
                RowBox[{"\"\<Weights\>\"", "\[Rule]", "w1"}], "|>"}]}]}], 
             "|>"}], ",", " ", 
            RowBox[{"<|", 
             RowBox[{"\"\<LayerType\>\"", "\[Rule]", "\"\<Sigmoid\>\""}], 
             "|>"}]}], "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "fullnet", "]"}], ";"}]}], "]"}]}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7392363408492002`*^9, 3.7392363867800283`*^9}, {
   3.7392365865210133`*^9, 3.73923658848264*^9}, 3.7392366291642575`*^9, {
   3.739236925745397*^9, 3.739236937152893*^9}, {3.739237607153409*^9, 
   3.739237665379557*^9}, {3.739237733059107*^9, 3.739237767879955*^9}, {
   3.7392380634746037`*^9, 3.739238070878793*^9}, {3.739238257701231*^9, 
   3.739238262335826*^9}, {3.739238742688015*^9, 3.7392387559714756`*^9}, {
   3.739238926006117*^9, 3.7392389302657194`*^9}, 3.7392390215943956`*^9, {
   3.7392390723416424`*^9, 3.7392390836713223`*^9}, {3.739241241916684*^9, 
   3.739241242714183*^9}, {3.7392415185423965`*^9, 3.739241553774172*^9}, {
   3.7392419184089336`*^9, 3.7392419250601397`*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"d3dcc3b0-4425-4353-824c-a85d9cc7fa60"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"input", ",", " ", "target"}], "}"}], " ", "=", " ", 
   RowBox[{"prepareData", "[", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.739239034465958*^9, 3.7392390619364614`*^9}, 
   3.739241005431731*^9},ExpressionUUID->"a5905e8b-421f-4ec9-afd4-\
0af80da6c72d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.739241949168438*^9, 
  3.739241950447016*^9}},ExpressionUUID->"58edd6d9-dc09-4ced-9a5c-\
f2a080cdca1d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "@", "target"}]], "Input",
 CellChangeTimes->{{3.7392419416766834`*^9, 3.739241952783736*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"286e95b9-6271-4112-a3f4-38a41655a5b0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"60000", ",", "10"}], "}"}]], "Output",
 CellChangeTimes->{{3.7392419450015974`*^9, 3.739241952844573*^9}, {
  3.7392420181488676`*^9, 3.7392420418265457`*^9}},
 CellLabel->"Out[73]=",ExpressionUUID->"a496fec5-c006-4775-9448-1b180f27d393"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"runNet", "[", 
  RowBox[{"input", ",", " ", "target"}], "]"}]], "Input",
 CellChangeTimes->{{3.739238843425057*^9, 3.739238845927361*^9}, {
  3.739238932247427*^9, 3.739238938919568*^9}, {3.739239051197195*^9, 
  3.739239066140214*^9}, {3.739241932079359*^9, 3.739241933486594*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"a642cd4c-61b0-4047-b8ab-597d67f5b86c"],

Cell[BoxData["fullnet$367615"], "Output",
 CellChangeTimes->{3.7392419340171747`*^9, 3.739242020005886*^9},
 CellLabel->"Out[72]=",ExpressionUUID->"728891ac-d495-4780-9e22-8eac9043aa96"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["fn"], "Input",
 CellChangeTimes->{{3.7392410210599174`*^9, 3.7392410249624786`*^9}, {
  3.739241059769354*^9, 3.7392410612473984`*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"61c3ace1-046d-485e-a91d-7dfcf050792a"],

Cell[BoxData["fullnet$362993"], "Output",
 CellChangeTimes->{3.7392410254471803`*^9, 3.739241094038555*^9},
 CellLabel->"Out[42]=",ExpressionUUID->"4c3734a3-23b1-43b4-9e9b-8a993a432341"]
}, Open  ]]
},
WindowSize->{958, 1028},
WindowMargins->{{Automatic, -7}, {Automatic, 0}},
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 7, 2018)",
StyleDefinitions->"ReverseColor.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 2464, 62, 124, "Input",ExpressionUUID->"7829bba4-9f62-4f5f-b7cb-a2e4b0bba986"],
Cell[3028, 84, 2457, 58, 143, "Input",ExpressionUUID->"9a01a0fc-7e26-4087-a77e-a5c55034816b"],
Cell[5488, 144, 1032, 26, 200, "Input",ExpressionUUID->"77c19d7a-ce8d-427d-81f6-6fcb70a24b02"],
Cell[6523, 172, 565, 14, 48, "Input",ExpressionUUID->"77d270d1-b953-461c-9bad-eb44c7207587"],
Cell[7091, 188, 1950, 53, 105, "Input",ExpressionUUID->"57345bbf-7009-4430-990a-36c88888c09e"],
Cell[9044, 243, 5663, 137, 371, "Input",ExpressionUUID->"0b01139e-8fc6-46c6-a8b0-a48450a9a150"],
Cell[14710, 382, 5241, 116, 295, "Input",ExpressionUUID->"d3dcc3b0-4425-4353-824c-a85d9cc7fa60"],
Cell[19954, 500, 325, 8, 28, "Input",ExpressionUUID->"a5905e8b-421f-4ec9-afd4-0af80da6c72d"],
Cell[20282, 510, 152, 3, 28, "Input",ExpressionUUID->"58edd6d9-dc09-4ced-9a5c-f2a080cdca1d"],
Cell[CellGroupData[{
Cell[20459, 517, 210, 3, 28, "Input",ExpressionUUID->"286e95b9-6271-4112-a3f4-38a41655a5b0"],
Cell[20672, 522, 278, 5, 32, "Output",ExpressionUUID->"a496fec5-c006-4775-9448-1b180f27d393"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20987, 532, 385, 6, 28, "Input",ExpressionUUID->"a642cd4c-61b0-4047-b8ab-597d67f5b86c"],
Cell[21375, 540, 186, 2, 32, "Output",ExpressionUUID->"728891ac-d495-4780-9e22-8eac9043aa96"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21598, 547, 228, 3, 28, "Input",ExpressionUUID->"61c3ace1-046d-485e-a91d-7dfcf050792a"],
Cell[21829, 552, 186, 2, 32, "Output",ExpressionUUID->"4c3734a3-23b1-43b4-9e9b-8a993a432341"]
}, Open  ]]
}
]
*)


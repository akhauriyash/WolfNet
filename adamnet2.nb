(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     29754,        727]
NotebookOptionsPosition[     27670,        688]
NotebookOutlinePosition[     28047,        704]
CellTagsIndexPosition[     28004,        701]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"learningrate", " ", "=", " ", "0.001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hiddennodes", " ", "=", " ", "500"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputnodes", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"batchsize", " ", "=", " ", "64"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epochs", " ", "=", " ", 
   RowBox[{"Floor", "[", 
    RowBox[{"60000", "/", "batchsize"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b1", " ", "=", " ", "0.9"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b2", " ", "=", " ", "0.99"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsilon", " ", "=", " ", "0.0000001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inputdim", "  ", "=", " ", "784"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"training", " ", "=", " ", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"ExampleData", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<MachineLearning\>\"", ",", "\"\<MNIST\>\""}], "}"}], ",", 
      "\"\<TrainingData\>\""}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tx", " ", "=", " ", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"ImageData", ",", " ", 
       RowBox[{"training", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"60000", ",", " ", "1", ",", " ", "784"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tt", "  ", "=", " ", 
   RowBox[{"training", "[", 
    RowBox[{"[", 
     RowBox[{";;", ",", " ", "2"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ty", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", 
     RowBox[{"{", 
      RowBox[{"60000", ",", " ", "1", ",", " ", "10"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", "60000"}], ",", " ", 
   RowBox[{"i", "++"}], ",", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ty", "[", 
      RowBox[{"[", 
       RowBox[{"i", ",", " ", "1", ",", " ", 
        RowBox[{"1", "+", 
         RowBox[{"tt", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], "]"}], " ", "=", " ", 
     "1"}], ";"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7391476528831434`*^9, 3.739147662570857*^9}, {
   3.7391477145539722`*^9, 3.739147714684647*^9}, {3.739183080713754*^9, 
   3.7391831066657753`*^9}, 3.739183747448804*^9, {3.739184778284623*^9, 
   3.739184778763136*^9}, {3.739184954794388*^9, 3.739184954966977*^9}, {
   3.739185135831162*^9, 3.739185135981758*^9}, 3.7391853386113033`*^9, {
   3.7391854738980036`*^9, 3.7391854743587885`*^9}, {3.739193995619089*^9, 
   3.73919407540515*^9}, {3.7391945731812906`*^9, 3.739194587588744*^9}, {
   3.739194885069962*^9, 3.739194885748148*^9}, {3.7391950576053534`*^9, 
   3.739195059603009*^9}, {3.739195748079439*^9, 3.7391957553340287`*^9}, {
   3.739196210135741*^9, 3.7391962131116*^9}, {3.7391963323332143`*^9, 
   3.7391963488889327`*^9}, {3.7391965059058313`*^9, 
   3.7391965140600157`*^9}, {3.73919668775113*^9, 3.739196735739766*^9}, {
   3.7391968366199503`*^9, 3.739196846786747*^9}, {3.7391969720546117`*^9, 
   3.7391969728135715`*^9}, {3.7391974770710597`*^9, 3.739197498586486*^9}, {
   3.7391984962743073`*^9, 3.739198524164669*^9}, {3.7391990570073442`*^9, 
   3.739199057161932*^9}, {3.7391992285952806`*^9, 3.7391992297053003`*^9}, {
   3.739199276255316*^9, 3.739199283873684*^9}, {3.739199395060211*^9, 
   3.7391993952068205`*^9}, {3.739202245926963*^9, 3.7392022485878224`*^9}, {
   3.7392043392551584`*^9, 3.739204349639889*^9}, 3.7392197918904486`*^9, {
   3.7392199663407097`*^9, 3.73921996880412*^9}, {3.7392201813644304`*^9, 
   3.7392201871918364`*^9}},ExpressionUUID->"9ef69ac0-10de-4ab5-b332-\
39bce14ea535"],

Cell[BoxData[
 RowBox[{"(*", "  ", 
  RowBox[{"w0", "                ", 
   RowBox[{"(", 
    RowBox[{"inputdim", ",", " ", "hiddennodes"}], ")"}], "  ", "w1", "             ", 
   RowBox[{"(", 
    RowBox[{"hiddennodes", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", "   ", "l0", "                ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", "inputdim"}], ")"}], "             ",
    "l1", "             ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", " ", "hiddennodes"}], ")"}], "          ",
    "l2", "             ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", " ", "l2Error", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "outputnodes"}], ")"}], "         ", "l2Delta", "        ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "outputnodes"}], ")"}], "          ", "l1Error", "        ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "\[IndentingNewLine]", " ",
    "l1Delta", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "         ", "g1", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "          ", "g0", "             ", 
   RowBox[{"(", 
    RowBox[{"inputdim", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", "   ", "l"}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.7391835684223084`*^9, 3.7391835709997406`*^9}, {
  3.739183623925087*^9, 3.7391836288437996`*^9}, {3.7392042851519113`*^9, 
  3.73920430793499*^9}},ExpressionUUID->"e1a2b6d6-7ce8-4675-bec5-\
747d5309d469"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sigmoid", "[", 
    RowBox[{"x_", ",", " ", "deriv_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"x", "*", 
       RowBox[{"(", 
        RowBox[{"1", "-", "x"}], ")"}]}], "]"}], ",", " ", 
     RowBox[{"Return", "[", " ", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Exp", "[", 
          RowBox[{"-", "x"}], "]"}]}], ")"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"relu", "[", 
    RowBox[{"x_", ",", " ", "deriv_"}], "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"UnitStep", "[", "x", "]"}], "]"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Abs", "[", "x", "]"}], "*", 
       RowBox[{"UnitStep", "[", "x", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"softmax", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", "]"}], ",", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{"x", "-", " ", 
         RowBox[{"Max", "[", "x", "]"}]}], "]"}], "/", 
       RowBox[{"Total", "[", 
        RowBox[{"Exp", "[", 
         RowBox[{"x", "-", " ", 
          RowBox[{"Max", "[", "x", "]"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MSE", "[", 
     RowBox[{"y_", ",", " ", "Y_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Mean", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"y", "-", "Y"}], ")"}], "^", "2"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Shape", " ", "of", " ", 
      RowBox[{"y", " ", "--"}]}], ">", " ", 
     RowBox[{"(", 
      RowBox[{"1", ",", "10"}], ")"}]}], ",", " ", 
    RowBox[{
     RowBox[{"shape", " ", "of", " ", 
      RowBox[{"X", " ", "--"}]}], ">", " ", 
     RowBox[{"(", 
      RowBox[{"1", ",", " ", "10"}], ")"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"crossEntropy", "[", 
      RowBox[{"X_", ",", " ", "y_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Total", "[", 
         RowBox[{"Total", "[", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{
             RowBox[{"y", "*", 
              RowBox[{"Log", "[", 
               RowBox[{"X", "+", "epsilon"}], "]"}]}], ",", " ", 
             RowBox[{"{", "3", "}"}]}], "]"}], ",", " ", 
           RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Dimensions", "[", "X", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"deltaCrossEntropy", "[", 
      RowBox[{"X_", ",", " ", "y_"}], "]"}], ":=", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"X", " ", "-", " ", "y"}], "]"}]}], ";"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7391992347224207`*^9, 3.739199250616897*^9}, {
   3.739199290224718*^9, 3.7391992933433743`*^9}, {3.739199824184043*^9, 
   3.7391998614538364`*^9}, {3.739200129966235*^9, 3.739200137133071*^9}, {
   3.739200372349378*^9, 3.739200449866604*^9}, {3.7392011899050555`*^9, 
   3.7392012082477903`*^9}, {3.7392014229770575`*^9, 
   3.7392014620410423`*^9}, {3.7392015265370393`*^9, 
   3.7392015501104665`*^9}, {3.7392017803112793`*^9, 
   3.7392018642865763`*^9}, {3.739202241827911*^9, 3.7392022994503*^9}, {
   3.739202363406682*^9, 3.739202388706999*^9}, {3.739203824337968*^9, 
   3.7392038616996794`*^9}, {3.7392047641688967`*^9, 3.739204768352705*^9}, {
   3.7392077232950788`*^9, 3.7392077260309114`*^9}, 3.7392139446281953`*^9, 
   3.739217301910493*^9, 3.7392176547599916`*^9},
 CellLabel->"In[38]:=",ExpressionUUID->"a3942673-5bd5-4f48-b4fc-55dea3b9de20"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"runNet", "[", 
    RowBox[{"net_", ",", " ", "tx_"}], "]"}], ":=", 
   RowBox[{"Return", "[", 
    RowBox[{"sigmoid", "[", 
     RowBox[{
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"relu", "[", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{"tx", ",", " ", 
            RowBox[{"net", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", " ", 
          RowBox[{"deriv", "=", "False"}]}], "]"}], ",", " ", 
        RowBox[{"net", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", 
      RowBox[{"deriv", "=", "False"}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7391992534064465`*^9, 3.73919925968865*^9}, 
   3.7391993625182734`*^9, {3.7392184160600586`*^9, 3.7392184346226196`*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"44e5af52-d1a2-46ee-82a9-0363e6f9e79e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"buildNet", "[", 
   RowBox[{
   "tx_", ",", " ", "ty_", ",", " ", "b1_", ",", " ", "b2_", ",", " ", 
    "epsilon_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "i", ",", " ", "w0", ",", " ", "w1", ",", "l2Error", ",", " ", "l2Delta",
       ",", " ", "l1Error", ",", " ", "l1Delta", ",", " ", "g1", ",", " ", 
      "g0", ",", " ", "l0", ",", " ", "l1", ",", " ", "l2", ",", "l2M", ",", 
      " ", "l1M", ",", " ", "l2V", ",", " ", "l1V", ",", " ", "l1MC", ",", 
      " ", "l1VC", ",", " ", "l2MC", ",", " ", "l2VC", ",", " ", "w1UDT", ",",
       " ", "w0UDT"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"w0", " ", "=", " ", 
      RowBox[{"RandomVariate", "[", 
       RowBox[{
        RowBox[{"NormalDistribution", "[", 
         RowBox[{"0", ",", "0.1"}], "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"inputdim", ",", " ", "hiddennodes"}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"w1", " ", "=", " ", 
      RowBox[{"RandomVariate", "[", 
       RowBox[{
        RowBox[{"NormalDistribution", "[", 
         RowBox[{"0", ",", " ", "0.1"}], "]"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"hiddennodes", ",", " ", "outputnodes"}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"l2M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l2V", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1V", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", "\t", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
       RowBox[{"i", "<=", "epochs"}], ",", " ", 
       RowBox[{"i", "+=", "batchsize"}], ",", " ", "\[IndentingNewLine]", 
       "\t", 
       RowBox[{
        RowBox[{"l0", " ", "=", " ", 
         RowBox[{"tx", "[", 
          RowBox[{"[", 
           RowBox[{"i", ";;", 
            RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}], ";", " ", 
        RowBox[{"l1", "=", " ", 
         RowBox[{"relu", "[", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"l0", ",", " ", "w0"}], "]"}], ",", " ", 
           RowBox[{"deriv", "=", "False"}]}], "]"}]}], ";", " ", 
        RowBox[{"l2", " ", "=", " ", 
         RowBox[{"sigmoid", "[", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{"l1", ",", " ", "w1"}], "]"}], ",", " ", 
           RowBox[{"deriv", "=", "False"}]}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"l2Error", " ", "=", " ", 
         RowBox[{"l2", " ", "-", " ", 
          RowBox[{"ty", "[", 
           RowBox[{"[", 
            RowBox[{"i", ";;", 
             RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"l2Delta", " ", "=", " ", 
         RowBox[{"l2Error", "*", 
          RowBox[{"sigmoid", "[", 
           RowBox[{"l2", ",", 
            RowBox[{"derive", "=", "True"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"l2Delta", " ", "=", " ", 
           RowBox[{"l2Error", "*", 
            RowBox[{"deltaCrossEntropy", "[", 
             RowBox[{"l2", ",", " ", 
              RowBox[{"ty", "[", 
               RowBox[{"[", 
                RowBox[{"i", ";;", 
                 RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}], "]"}]}]}],
           ";"}], "\t", "*)"}], "                                    ", 
        "\[IndentingNewLine]", 
        RowBox[{"l1Error", " ", "=", " ", 
         RowBox[{"Dot", "[", 
          RowBox[{"l2Delta", ",", " ", 
           RowBox[{"Transpose", "[", "w1", "]"}]}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"l1Delta", " ", "=", " ", 
         RowBox[{"l1Error", "*", 
          RowBox[{"relu", "[", 
           RowBox[{"l1", ",", " ", 
            RowBox[{"deriv", "=", "True"}]}], "]"}]}]}], ";", "  ", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"WHAT", " ", "ARE", " ", "YOU", " ", "DOING"}], "*)"}], 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"g1", " ", "=", " ", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"l1", ",", " ", 
                RowBox[{"2", "\[TwoWayRule]", " ", "3"}]}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"l2Delta", ",", " ", 
                 RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], 
             "]"}], ",", " ", 
            RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], ";", "  ",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"WHAT", " ", "ARE", " ", "YOU", " ", "DOING"}], "*)"}], 
        "\[IndentingNewLine]", "         ", 
        RowBox[{"g0", " ", "=", " ", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"l0", ",", " ", 
                RowBox[{"2", "\[TwoWayRule]", " ", "3"}]}], "]"}], ",", " ", 
              RowBox[{
               RowBox[{"Total", "[", 
                RowBox[{"l1Delta", ",", " ", 
                 RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], 
             "]"}], ",", " ", 
            RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], ";", 
        "  \t", "\[IndentingNewLine]", "\t", 
        RowBox[{"l2M", " ", "=", " ", 
         RowBox[{
          RowBox[{"l2M", "*", "b1"}], " ", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "b1"}], ")"}], "*", "g1"}]}]}], ";", 
        RowBox[{"l1M", " ", "=", " ", 
         RowBox[{
          RowBox[{"l1M", "*", "b2"}], " ", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "b2"}], ")"}], "*", "g0"}]}]}], ";", 
        "\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"l2V", " ", "=", " ", 
         RowBox[{
          RowBox[{"l2V", "*", "b2"}], " ", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "b2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"g1", "*", "g1"}], ")"}]}]}]}], ";", 
        "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"l1V", " ", "=", " ", 
         RowBox[{
          RowBox[{"l1V", "*", "b1"}], " ", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "b1"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"g0", "*", "g0"}], ")"}]}]}]}], ";", 
        "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"l1MC", " ", "=", " ", 
         RowBox[{"l1M", "/", 
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", " ", 
        RowBox[{"l1VC", " ", "=", " ", 
         RowBox[{"l1V", "/", 
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", 
        "\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"l2MC", " ", "=", " ", 
         RowBox[{"l2M", "/", 
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", " ", 
        RowBox[{"l2VC", " ", "=", " ", 
         RowBox[{"l2V", "/", 
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"w1UDT", " ", "=", 
         RowBox[{"l2MC", "/", 
          RowBox[{"(", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"l2VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";",
         "\t\t\t\t\t\t\t\t\t\t\t\t", 
        RowBox[{"w0UDT", " ", "=", " ", 
         RowBox[{"l1MC", "/", 
          RowBox[{"(", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"l1VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], ";",
         "\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"w1", " ", "-=", " ", 
         RowBox[{"learningrate", "*", "w1UDT"}]}], ";", 
        "\t\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
        RowBox[{"w0", " ", "-=", " ", 
         RowBox[{"learningrate", "*", "w0UDT"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Mod", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", " ", "64"}], "]"}], "\[Equal]", 
           "0"}], ",", " ", 
          RowBox[{"Print", "[", 
           RowBox[{"MSE", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"runNet", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"w0", ",", " ", "w1"}], "}"}], ",", " ", 
                RowBox[{"tx", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", " ", 
             RowBox[{"Flatten", "[", 
              RowBox[{"ty", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], "]"}],
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"w0", ",", " ", "w1"}], "}"}], "]"}], ";"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7391992612843556`*^9, 3.7391992719857254`*^9}, 
   3.739199370306464*^9, {3.7391995746087933`*^9, 3.739199575595129*^9}, {
   3.7392001834940405`*^9, 3.739200194466669*^9}, {3.7392005909049153`*^9, 
   3.739200601958338*^9}, {3.739201405660389*^9, 3.7392014136659718`*^9}, {
   3.739201783868734*^9, 3.739201784296587*^9}, {3.739203773130968*^9, 
   3.7392038160421667`*^9}, {3.7392040089744616`*^9, 3.739204026116598*^9}, {
   3.7392043189395103`*^9, 3.739204333925416*^9}, {3.739204394826993*^9, 
   3.739204397050045*^9}, 3.739207772330789*^9, {3.7392109798480663`*^9, 
   3.7392110202366242`*^9}, 3.7392110812804403`*^9, {3.739213100837415*^9, 
   3.7392131010079927`*^9}, {3.7392139633386917`*^9, 3.7392139794029427`*^9}, 
   3.7392142835780053`*^9, {3.7392143432569966`*^9, 3.739214409537236*^9}, {
   3.739214554444317*^9, 3.7392145827854257`*^9}, 3.739214675499508*^9, {
   3.739214825779476*^9, 3.7392148382236967`*^9}, {3.739215888237558*^9, 
   3.7392159366490183`*^9}, {3.739216309620159*^9, 3.7392163128186007`*^9}, {
   3.7392164310231056`*^9, 3.7392164647178164`*^9}, {3.7392166741203804`*^9, 
   3.7392167952817097`*^9}, {3.739217078226631*^9, 3.739217109006442*^9}, {
   3.739217248882512*^9, 3.7392172621653433`*^9}, {3.7392174457568502`*^9, 
   3.739217453223757*^9}, {3.739218328075309*^9, 3.7392183353300447`*^9}, {
   3.739218466638962*^9, 3.739218472036522*^9}, {3.7392193193826737`*^9, 
   3.7392193209680605`*^9}, {3.739219434932911*^9, 3.7392194656909533`*^9}, {
   3.7392198091631594`*^9, 3.739219813235222*^9}, {3.739219951491438*^9, 
   3.739219956514001*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"0d246342-a2cf-4109-818d-b8fec17e025b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"z", " ", "=", " ", 
   RowBox[{"buildNet", "[", 
    RowBox[{
    "tx", ",", " ", "ty", ",", " ", "b1", ",", " ", "b2", ",", " ", 
     "epsilon"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7391842745948677`*^9, 3.7391842776082344`*^9}, {
   3.73918458194786*^9, 3.739184583395079*^9}, {3.7391846795089464`*^9, 
   3.7391846828237514`*^9}, {3.739198483283041*^9, 3.7391984911051435`*^9}, 
   3.7391993751494813`*^9},
 CellLabel->"In[51]:=",ExpressionUUID->"ef5ab3a2-1643-45ed-959d-84f47e0c95c2"],

Cell[CellGroupData[{

Cell[BoxData["0.3`"], "Print",
 CellChangeTimes->{3.739219978068334*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"344afe82-f33b-4af8-b415-e18d57425e30"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.7392199784892073`*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"6da74a41-90d5-4d6d-9f47-cd916ce5918d"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739219978882157*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"a462f1ae-bb54-4b6c-9d52-cbfdb35bef03"],

Cell[BoxData["0.3`"], "Print",
 CellChangeTimes->{3.739219979292059*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"cfd7f35b-e872-4973-965b-92b79d230333"]
}, Open  ]],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"6.649936585489607`*^-247\\\", \\\" \\\", \
\\\"6.649936585489607`*^-247\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,51,9,
   30264743044457531448,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739219980688325*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"a6095026-fe43-4617-a9f7-8eea7895df9d"],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"9.603388639504006`*^-242\\\", \\\" \\\", \
\\\"9.603388639504006`*^-242\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,51,10,
   30264743044457531448,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739219981682665*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"14594a32-9efd-498d-b33e-5d40731f1bb6"],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"3.750921909830907`*^-228\\\", \\\" \\\", \
\\\"3.750921909830907`*^-228\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,51,11,
   30264743044457531448,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7392199826780024`*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"7d2b87d4-1a79-48aa-ac4c-89706efc1a1b"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"General\\\", \
\\\"::\\\", \\\"munfl\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"",2,51,12,30264743044457531448,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.739219983459911*^9},
 CellLabel->
  "During evaluation of \
In[51]:=",ExpressionUUID->"89cce1ce-e672-42c1-b58c-0fb7392fb7bc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"runNet", "[", 
  RowBox[{"z", ",", " ", 
   RowBox[{"tx", "[", 
    RowBox[{"[", "42452", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.739219653696536*^9, 3.739219660863119*^9}, {
  3.7392197027101164`*^9, 3.7392197697206182`*^9}, {3.7392198794692435`*^9, 
  3.739219881290923*^9}, {3.739220069843794*^9, 3.7392200715582075`*^9}},
 CellLabel->"In[54]:=",ExpressionUUID->"aaa3dec1-28dc-4d1d-8085-2ad31190d2ca"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "4.67441936368668747927983226736983372172`11.861968928058975*^-5376", ",", 
    "4.206330229830239537699`11.866921795453262*^-5315", ",", 
    "1.864353160437133323795721563794711620917`11.899462906200577*^-4931", 
    ",", "3.590520818869847734646708970476541`11.79674117207658*^-6247", ",", 
    "8.3930392854322282942307524`11.928195216611645*^-4616", ",", "1.`", ",", 
    "1.`", ",", "8.96003102011332678211914326`11.867357454921658*^-5310", ",",
     "9.17034408432449387574198348577`12.021010305686886*^-3728", ",", 
    "4.367533523216716940005969538817402`12.493605876772516*^-1256"}], "}"}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.7392197271814065`*^9, 3.7392197700228157`*^9}, {
  3.7392198764096556`*^9, 3.739219881622035*^9}, {3.73922006303102*^9, 
  3.7392200721117277`*^9}},
 CellLabel->"Out[54]=",ExpressionUUID->"168e392b-a1c0-4818-8fb4-5ff01908a555"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ty", "[", 
  RowBox[{"[", "42214", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7392197341690483`*^9, 3.7392197796269417`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"4bdc6864-3bc3-4b71-b0c9-2f7940eee5cb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "0", ",", "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", 
    ",", "0", ",", "0"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.7392197373078203`*^9, 3.739219779831328*^9}},
 CellLabel->"Out[37]=",ExpressionUUID->"64ee0e8a-1d24-405c-a985-dc4b5a929f53"]
}, Open  ]]
},
WindowSize->{990, 1028},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 7, 2018)",
StyleDefinitions->"ReverseColor.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 4020, 92, 319, "Input",ExpressionUUID->"9ef69ac0-10de-4ab5-b332-39bce14ea535"],
Cell[4584, 114, 1668, 35, 209, "Input",ExpressionUUID->"e1a2b6d6-7ce8-4675-bec5-747d5309d469"],
Cell[6255, 151, 4198, 114, 165, "Input",ExpressionUUID->"a3942673-5bd5-4f48-b4fc-55dea3b9de20"],
Cell[10456, 267, 891, 22, 32, "Input",ExpressionUUID->"44e5af52-d1a2-46ee-82a9-0363e6f9e79e"],
Cell[11350, 291, 11086, 252, 671, "Input",ExpressionUUID->"0d246342-a2cf-4109-818d-b8fec17e025b"],
Cell[CellGroupData[{
Cell[22461, 547, 537, 11, 32, "Input",ExpressionUUID->"ef5ab3a2-1643-45ed-959d-84f47e0c95c2"],
Cell[CellGroupData[{
Cell[23023, 562, 177, 4, 23, "Print",ExpressionUUID->"344afe82-f33b-4af8-b415-e18d57425e30"],
Cell[23203, 568, 179, 4, 23, "Print",ExpressionUUID->"6da74a41-90d5-4d6d-9f47-cd916ce5918d"],
Cell[23385, 574, 177, 4, 23, "Print",ExpressionUUID->"a462f1ae-bb54-4b6c-9d52-cbfdb35bef03"],
Cell[23565, 580, 177, 4, 23, "Print",ExpressionUUID->"cfd7f35b-e872-4973-965b-92b79d230333"]
}, Open  ]],
Cell[23757, 587, 473, 11, 25, "Message",ExpressionUUID->"a6095026-fe43-4617-a9f7-8eea7895df9d"],
Cell[24233, 600, 474, 11, 25, "Message",ExpressionUUID->"14594a32-9efd-498d-b33e-5d40731f1bb6"],
Cell[24710, 613, 476, 11, 25, "Message",ExpressionUUID->"7d2b87d4-1a79-48aa-ac4c-89706efc1a1b"],
Cell[25189, 626, 446, 10, 23, "Message",ExpressionUUID->"89cce1ce-e672-42c1-b58c-0fb7392fb7bc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[25672, 641, 443, 8, 32, "Input",ExpressionUUID->"aaa3dec1-28dc-4d1d-8085-2ad31190d2ca"],
Cell[26118, 651, 932, 16, 69, "Output",ExpressionUUID->"168e392b-a1c0-4818-8fb4-5ff01908a555"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27087, 672, 231, 4, 32, "Input",ExpressionUUID->"4bdc6864-3bc3-4b71-b0c9-2f7940eee5cb"],
Cell[27321, 678, 333, 7, 36, "Output",ExpressionUUID->"64ee0e8a-1d24-405c-a985-dc4b5a929f53"]
}, Open  ]]
}
]
*)


(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     35605,        838]
NotebookOptionsPosition[     33111,        793]
NotebookOutlinePosition[     33488,        809]
CellTagsIndexPosition[     33445,        806]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"training", " ", "=", " ", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"ExampleData", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<MachineLearning\>\"", ",", "\"\<MNIST\>\""}], "}"}], ",", 
      "\"\<TrainingData\>\""}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tx", " ", "=", " ", 
   RowBox[{"ArrayReshape", "[", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"ImageData", ",", " ", 
       RowBox[{"training", "[", 
        RowBox[{"[", 
         RowBox[{";;", ",", " ", "1"}], "]"}], "]"}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"60000", ",", " ", "1", ",", " ", "784"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tt", "  ", "=", " ", 
   RowBox[{"training", "[", 
    RowBox[{"[", 
     RowBox[{";;", ",", " ", "2"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ty", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", " ", 
     RowBox[{"{", 
      RowBox[{"60000", ",", " ", "1", ",", " ", "10"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"For", "[", 
  RowBox[{
   RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
   RowBox[{"i", "\[LessEqual]", "60000"}], ",", " ", 
   RowBox[{"i", "++"}], ",", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"ty", "[", 
      RowBox[{"[", 
       RowBox[{"i", ",", " ", "1", ",", " ", 
        RowBox[{"1", "+", 
         RowBox[{"tt", "[", 
          RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}], "]"}], " ", "=", " ", 
     "1"}], ";"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7391476528831434`*^9, 3.739147662570857*^9}, {
   3.7391477145539722`*^9, 3.739147714684647*^9}, {3.739183080713754*^9, 
   3.7391831066657753`*^9}, 3.739183747448804*^9, {3.739184778284623*^9, 
   3.739184778763136*^9}, {3.739184954794388*^9, 3.739184954966977*^9}, {
   3.739185135831162*^9, 3.739185135981758*^9}, 3.7391853386113033`*^9, {
   3.7391854738980036`*^9, 3.7391854743587885`*^9}, {3.739193995619089*^9, 
   3.73919407540515*^9}, {3.7391945731812906`*^9, 3.739194587588744*^9}, {
   3.739194885069962*^9, 3.739194885748148*^9}, {3.7391950576053534`*^9, 
   3.739195059603009*^9}, {3.739195748079439*^9, 3.7391957553340287`*^9}, {
   3.739196210135741*^9, 3.7391962131116*^9}, {3.7391963323332143`*^9, 
   3.7391963488889327`*^9}, {3.7391965059058313`*^9, 
   3.7391965140600157`*^9}, {3.73919668775113*^9, 3.739196735739766*^9}, {
   3.7391968366199503`*^9, 3.739196846786747*^9}, {3.7391969720546117`*^9, 
   3.7391969728135715`*^9}, {3.7391974770710597`*^9, 3.739197498586486*^9}, {
   3.7391984962743073`*^9, 3.739198524164669*^9}, {3.7391990570073442`*^9, 
   3.739199057161932*^9}, {3.7391992285952806`*^9, 3.7391992297053003`*^9}, {
   3.739199276255316*^9, 3.739199283873684*^9}, {3.739199395060211*^9, 
   3.7391993952068205`*^9}, {3.739202245926963*^9, 3.7392022485878224`*^9}, {
   3.7392043392551584`*^9, 3.739204349639889*^9}, 3.7392197918904486`*^9, {
   3.7392199663407097`*^9, 3.73921996880412*^9}, {3.7392201813644304`*^9, 
   3.7392201871918364`*^9}, {3.739220422004242*^9, 3.73922042573925*^9}, {
   3.739222405313574*^9, 3.7392224054881067`*^9}, {3.7392231658330665`*^9, 
   3.739223167106659*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"9ef69ac0-10de-4ab5-b332-39bce14ea535"],

Cell[BoxData[
 RowBox[{"(*", "  ", 
  RowBox[{"w0", "                ", 
   RowBox[{"(", 
    RowBox[{"inputdim", ",", " ", "hiddennodes"}], ")"}], "  ", "w1", "             ", 
   RowBox[{"(", 
    RowBox[{"hiddennodes", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", "   ", "l0", "                ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", "inputdim"}], ")"}], "             ",
    "l1", "             ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", " ", "hiddennodes"}], ")"}], "          ",
    "l2", "             ", 
   RowBox[{"(", 
    RowBox[{"batchsize", ",", " ", "1", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", " ", "l2Error", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "outputnodes"}], ")"}], "         ", "l2Delta", "        ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "outputnodes"}], ")"}], "          ", "l1Error", "        ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "\[IndentingNewLine]", " ",
    "l1Delta", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "         ", "g1", "             ", 
   RowBox[{"(", 
    RowBox[{"1", ",", " ", "hiddennodes"}], ")"}], "          ", "g0", "             ", 
   RowBox[{"(", 
    RowBox[{"inputdim", ",", " ", "outputnodes"}], ")"}], 
   "\[IndentingNewLine]", "   ", "l"}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.7391835684223084`*^9, 3.7391835709997406`*^9}, {
  3.739183623925087*^9, 3.7391836288437996`*^9}, {3.7392042851519113`*^9, 
  3.73920430793499*^9}},ExpressionUUID->"e1a2b6d6-7ce8-4675-bec5-\
747d5309d469"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"learningrate", " ", "=", " ", "0.001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hiddennodes", " ", "=", " ", "512"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"outputnodes", " ", "=", " ", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"batchsize", " ", "=", " ", "32"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"iterations", " ", "=", " ", 
   RowBox[{"Floor", "[", 
    RowBox[{"60000", "/", "batchsize"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epochs", " ", "=", " ", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b1", " ", "=", " ", "0.9"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b2", " ", "=", " ", "0.99"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"epsilon", " ", "=", " ", "0.00000001"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"inputdim", "  ", "=", " ", "784"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sigmoid", "[", 
    RowBox[{"x_", ",", " ", "deriv_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"x", "*", 
       RowBox[{"(", 
        RowBox[{"1", "-", "x"}], ")"}]}], "]"}], ",", " ", 
     RowBox[{"Return", "[", " ", 
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Exp", "[", 
          RowBox[{"-", "x"}], "]"}]}], ")"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"relu", "[", 
    RowBox[{"x_", ",", " ", "deriv_"}], "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"UnitStep", "[", "x", "]"}], "]"}], ",", " ", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Abs", "[", "x", "]"}], "*", 
       RowBox[{"UnitStep", "[", "x", "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"softmax", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"deriv", "\[Equal]", "True"}], ",", " ", 
     RowBox[{"Return", "[", "]"}], ",", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{"x", "-", " ", 
         RowBox[{"Max", "[", "x", "]"}]}], "]"}], "/", 
       RowBox[{"Total", "[", 
        RowBox[{"Exp", "[", 
         RowBox[{"x", "-", " ", 
          RowBox[{"Max", "[", "x", "]"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MSE", "[", 
     RowBox[{"y_", ",", " ", "Y_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Mean", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"y", "-", "Y"}], ")"}], "^", "2"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Shape", " ", "of", " ", 
      RowBox[{"y", " ", "--"}]}], ">", " ", 
     RowBox[{"(", 
      RowBox[{"1", ",", "10"}], ")"}]}], ",", " ", 
    RowBox[{
     RowBox[{"shape", " ", "of", " ", 
      RowBox[{"X", " ", "--"}]}], ">", " ", 
     RowBox[{"(", 
      RowBox[{"1", ",", " ", "10"}], ")"}]}]}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"crossEntropy", "[", 
      RowBox[{"X_", ",", " ", "y_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"Total", "[", 
         RowBox[{"Total", "[", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{
             RowBox[{"y", "*", 
              RowBox[{"Log", "[", 
               RowBox[{"X", "+", "epsilon"}], "]"}]}], ",", " ", 
             RowBox[{"{", "3", "}"}]}], "]"}], ",", " ", 
           RowBox[{"{", "2", "}"}]}], "]"}], "]"}]}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Dimensions", "[", "X", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ")"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"deltaCrossEntropy", "[", 
      RowBox[{"X_", ",", " ", "y_"}], "]"}], ":=", " ", 
     RowBox[{"Return", "[", 
      RowBox[{"X", " ", "-", " ", "y"}], "]"}]}], ";"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7391992347224207`*^9, 3.739199250616897*^9}, {
   3.739199290224718*^9, 3.7391992933433743`*^9}, {3.739199824184043*^9, 
   3.7391998614538364`*^9}, {3.739200129966235*^9, 3.739200137133071*^9}, {
   3.739200372349378*^9, 3.739200449866604*^9}, {3.7392011899050555`*^9, 
   3.7392012082477903`*^9}, {3.7392014229770575`*^9, 
   3.7392014620410423`*^9}, {3.7392015265370393`*^9, 
   3.7392015501104665`*^9}, {3.7392017803112793`*^9, 
   3.7392018642865763`*^9}, {3.739202241827911*^9, 3.7392022994503*^9}, {
   3.739202363406682*^9, 3.739202388706999*^9}, {3.739203824337968*^9, 
   3.7392038616996794`*^9}, {3.7392047641688967`*^9, 3.739204768352705*^9}, {
   3.7392077232950788`*^9, 3.7392077260309114`*^9}, 3.7392139446281953`*^9, 
   3.739217301910493*^9, 3.7392176547599916`*^9, {3.739223169208037*^9, 
   3.7392231711827908`*^9}, {3.7392232205686255`*^9, 3.7392232207920446`*^9}, 
   3.7392234292154026`*^9, {3.739224110146385*^9, 3.7392241383924274`*^9}, {
   3.7392241827388687`*^9, 3.7392241829598565`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"a3942673-5bd5-4f48-b4fc-55dea3b9de20"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"runNet", "[", 
    RowBox[{"net_", ",", " ", "tx_"}], "]"}], ":=", 
   RowBox[{"Return", "[", 
    RowBox[{"sigmoid", "[", 
     RowBox[{
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"relu", "[", 
         RowBox[{
          RowBox[{"Dot", "[", 
           RowBox[{"tx", ",", " ", 
            RowBox[{"net", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", " ", 
          RowBox[{"deriv", "=", "False"}]}], "]"}], ",", " ", 
        RowBox[{"net", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", " ", 
      RowBox[{"deriv", "=", "False"}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7391992534064465`*^9, 3.73919925968865*^9}, 
   3.7391993625182734`*^9, {3.7392184160600586`*^9, 3.7392184346226196`*^9}},
 CellLabel->"In[97]:=",ExpressionUUID->"44e5af52-d1a2-46ee-82a9-0363e6f9e79e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"buildNet", "[", 
   RowBox[{
   "tx_", ",", " ", "ty_", ",", " ", "b1_", ",", " ", "b2_", ",", " ", 
    "epsilon_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "i", ",", " ", "w0", ",", " ", "w1", ",", "l2Error", ",", " ", "l2Delta",
       ",", " ", "l1Error", ",", " ", "l1Delta", ",", " ", "g1", ",", " ", 
      "g0", ",", " ", "l0", ",", " ", "l1", ",", " ", "l2", ",", "l2M", ",", 
      " ", "l1M", ",", " ", "l2V", ",", " ", "l1V", ",", " ", "l1MC", ",", 
      " ", "l1VC", ",", " ", "l2MC", ",", " ", "l2VC", ",", " ", "w1UDT", ",",
       " ", "w0UDT"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"mininet", " ", "=", " ", 
      RowBox[{"NetChain", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"LinearLayer", "[", "hiddennodes", "]"}], ",", " ", "Ramp", 
          ",", " ", 
          RowBox[{"LinearLayer", "[", "outputnodes", "]"}], ",", " ", 
          "LogisticSigmoid"}], "}"}], ",", " ", 
        RowBox[{"\"\<Input\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"1", ",", " ", "784"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"netinit", " ", "=", " ", 
      RowBox[{"NetInitialize", "[", 
       RowBox[{"mininet", ",", " ", 
        RowBox[{"Method", " ", "\[Rule]", 
         RowBox[{"{", "\"\<Xavier\>\"", "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"w0", " ", "=", " ", 
      RowBox[{"Transpose", "@", 
       RowBox[{
        RowBox[{"NetExtract", "[", 
         RowBox[{"netinit", ",", " ", 
          RowBox[{"{", 
           RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"w1", " ", "=", " ", 
      RowBox[{"Transpose", "@", 
       RowBox[{
        RowBox[{"NetExtract", "[", 
         RowBox[{"netinit", ",", " ", 
          RowBox[{"{", 
           RowBox[{"All", ",", " ", "\"\<Weights\>\""}], "}"}]}], "]"}], "[", 
        RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"w0", " ", "=", " ", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0", ",", "0.1"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"inputdim", ",", " ", "hiddennodes"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"w1", " ", "=", " ", 
        RowBox[{"RandomVariate", "[", 
         RowBox[{
          RowBox[{"NormalDistribution", "[", 
           RowBox[{"0", ",", " ", "0.1"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"hiddennodes", ",", " ", "outputnodes"}], "}"}]}], "]"}]}],
        ";"}], "*)"}], "\[IndentingNewLine]", "\t", 
     RowBox[{"l2M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1M", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l2V", " ", "=", " ", "0"}], ";", " ", 
     RowBox[{"l1V", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", " ", "=", " ", "1"}], ",", " ", 
          RowBox[{"i", "\[LessEqual]", "iterations"}], ",", " ", 
          RowBox[{"i", "+=", "batchsize"}], ",", " ", "\[IndentingNewLine]", 
          "\t", 
          RowBox[{
           RowBox[{"l0", " ", "=", " ", 
            RowBox[{"tx", "[", 
             RowBox[{"[", 
              RowBox[{"i", ";;", 
               RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}], ";", " ", 
           RowBox[{"l1", "=", " ", 
            RowBox[{"relu", "[", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"l0", ",", " ", "w0"}], "]"}], ",", " ", 
              RowBox[{"deriv", "=", "False"}]}], "]"}]}], ";", " ", 
           RowBox[{"l2", " ", "=", " ", 
            RowBox[{"sigmoid", "[", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"l1", ",", " ", "w1"}], "]"}], ",", " ", 
              RowBox[{"deriv", "=", "False"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"l2Error", " ", "=", " ", 
            RowBox[{"l2", " ", "-", " ", 
             RowBox[{"ty", "[", 
              RowBox[{"[", 
               RowBox[{"i", ";;", 
                RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}]}], ";", " ",
            "\[IndentingNewLine]", 
           RowBox[{"l2Delta", " ", "=", " ", 
            RowBox[{"l2Error", "*", 
             RowBox[{"sigmoid", "[", 
              RowBox[{"l2", ",", 
               RowBox[{"derive", "=", "True"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"l2Delta", " ", "=", " ", 
              RowBox[{"l2Error", "*", 
               RowBox[{"deltaCrossEntropy", "[", 
                RowBox[{"l2", ",", " ", 
                 RowBox[{"ty", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ";;", 
                    RowBox[{"i", "+", "batchsize"}]}], "]"}], "]"}]}], 
                "]"}]}]}], ";"}], "\t", "*)"}], 
           "                                    ", "\[IndentingNewLine]", 
           RowBox[{"l1Error", " ", "=", " ", 
            RowBox[{"Dot", "[", 
             RowBox[{"l2Delta", ",", " ", 
              RowBox[{"Transpose", "[", "w1", "]"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"l1Delta", " ", "=", " ", 
            RowBox[{"l1Error", "*", 
             RowBox[{"relu", "[", 
              RowBox[{"l1", ",", " ", 
               RowBox[{"deriv", "=", "True"}]}], "]"}]}]}], ";", "  ", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"WHAT", " ", "ARE", " ", "YOU", " ", "DOING"}], "*)"}], 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"g1", " ", "=", " ", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{
                 RowBox[{"Transpose", "[", 
                  RowBox[{"l1", ",", " ", 
                   RowBox[{"2", "\[TwoWayRule]", " ", "3"}]}], "]"}], ",", 
                 " ", 
                 RowBox[{
                  RowBox[{"Total", "[", 
                   RowBox[{"l2Delta", ",", " ", 
                    RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], 
                "]"}], ",", " ", 
               RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], ";", 
           "  ", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"WHAT", " ", "ARE", " ", "YOU", " ", "DOING"}], "*)"}], 
           "\[IndentingNewLine]", "         ", 
           RowBox[{"g0", " ", "=", " ", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{"Dot", "[", 
                RowBox[{
                 RowBox[{"Transpose", "[", 
                  RowBox[{"l0", ",", " ", 
                   RowBox[{"2", "\[TwoWayRule]", " ", "3"}]}], "]"}], ",", 
                 " ", 
                 RowBox[{
                  RowBox[{"Total", "[", 
                   RowBox[{"l1Delta", ",", " ", 
                    RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], 
                "]"}], ",", " ", 
               RowBox[{"{", "1", "}"}]}], "]"}], "/", "batchsize"}]}], ";", 
           "  \t", "\[IndentingNewLine]", "\t", 
           RowBox[{"l2M", " ", "=", " ", 
            RowBox[{
             RowBox[{"l2M", "*", "b1"}], " ", "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "b1"}], ")"}], "*", "g1"}]}]}], ";", 
           RowBox[{"l1M", " ", "=", " ", 
            RowBox[{
             RowBox[{"l1M", "*", "b2"}], " ", "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "b2"}], ")"}], "*", "g0"}]}]}], ";", 
           "\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"l2V", " ", "=", " ", 
            RowBox[{
             RowBox[{"l2V", "*", "b2"}], " ", "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "b2"}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{"g1", "*", "g1"}], ")"}]}]}]}], ";", 
           "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"l1V", " ", "=", " ", 
            RowBox[{
             RowBox[{"l1V", "*", "b1"}], " ", "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", "b1"}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{"g0", "*", "g0"}], ")"}]}]}]}], ";", 
           "\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"l1MC", " ", "=", " ", 
            RowBox[{"l1M", "/", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", " ", 
           RowBox[{"l1VC", " ", "=", " ", 
            RowBox[{"l1V", "/", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"b1", "^", "i"}]}], ")"}]}]}], ";", 
           "\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"l2MC", " ", "=", " ", 
            RowBox[{"l2M", "/", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", " ", 
           RowBox[{"l2VC", " ", "=", " ", 
            RowBox[{"l2V", "/", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"b2", "^", "i"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"w1UDT", " ", "=", 
            RowBox[{"l2MC", "/", 
             RowBox[{"(", 
              RowBox[{"Sqrt", "[", 
               RowBox[{"l2VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], 
           ";", "\t\t\t\t\t\t\t\t\t\t\t\t", 
           RowBox[{"w0UDT", " ", "=", " ", 
            RowBox[{"l1MC", "/", 
             RowBox[{"(", 
              RowBox[{"Sqrt", "[", 
               RowBox[{"l1VC", " ", "+", " ", "epsilon"}], "]"}], ")"}]}]}], 
           ";", "\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"w1", " ", "-=", " ", 
            RowBox[{"learningrate", "*", "w1UDT"}]}], ";", 
           "\t\t\t\t\t\t\t\t\t\t\t\t\t", "\[IndentingNewLine]", "\t", 
           RowBox[{"w0", " ", "-=", " ", 
            RowBox[{"learningrate", "*", "w0UDT"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"i", "-", "1"}], ",", " ", "1024"}], "]"}], 
              "\[Equal]", "0"}], ",", " ", 
             RowBox[{"Print", "[", 
              RowBox[{"MSE", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"runNet", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"w0", ",", " ", "w1"}], "}"}], ",", " ", 
                   RowBox[{"tx", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", " ", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"ty", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], "]"}]}], 
            "]"}], ";"}]}], "]"}], ",", " ", "epochs"}], "]"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"w0", ",", " ", "w1"}], "}"}], "]"}]}], ";"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7391992612843556`*^9, 3.7391992719857254`*^9}, 
   3.739199370306464*^9, {3.7391995746087933`*^9, 3.739199575595129*^9}, {
   3.7392001834940405`*^9, 3.739200194466669*^9}, {3.7392005909049153`*^9, 
   3.739200601958338*^9}, {3.739201405660389*^9, 3.7392014136659718`*^9}, {
   3.739201783868734*^9, 3.739201784296587*^9}, {3.739203773130968*^9, 
   3.7392038160421667`*^9}, {3.7392040089744616`*^9, 3.739204026116598*^9}, {
   3.7392043189395103`*^9, 3.739204333925416*^9}, {3.739204394826993*^9, 
   3.739204397050045*^9}, 3.739207772330789*^9, {3.7392109798480663`*^9, 
   3.7392110202366242`*^9}, 3.7392110812804403`*^9, {3.739213100837415*^9, 
   3.7392131010079927`*^9}, {3.7392139633386917`*^9, 3.7392139794029427`*^9}, 
   3.7392142835780053`*^9, {3.7392143432569966`*^9, 3.739214409537236*^9}, {
   3.739214554444317*^9, 3.7392145827854257`*^9}, 3.739214675499508*^9, {
   3.739214825779476*^9, 3.7392148382236967`*^9}, {3.739215888237558*^9, 
   3.7392159366490183`*^9}, {3.739216309620159*^9, 3.7392163128186007`*^9}, {
   3.7392164310231056`*^9, 3.7392164647178164`*^9}, {3.7392166741203804`*^9, 
   3.7392167952817097`*^9}, {3.739217078226631*^9, 3.739217109006442*^9}, {
   3.739217248882512*^9, 3.7392172621653433`*^9}, {3.7392174457568502`*^9, 
   3.739217453223757*^9}, {3.739218328075309*^9, 3.7392183353300447`*^9}, {
   3.739218466638962*^9, 3.739218472036522*^9}, {3.7392193193826737`*^9, 
   3.7392193209680605`*^9}, {3.739219434932911*^9, 3.7392194656909533`*^9}, {
   3.7392198091631594`*^9, 3.739219813235222*^9}, {3.739219951491438*^9, 
   3.739219956514001*^9}, {3.739220413195808*^9, 3.7392204481463127`*^9}, {
   3.7392206661590223`*^9, 3.7392206802403584`*^9}, {3.739222067281087*^9, 
   3.73922212730726*^9}, {3.7392221893942657`*^9, 3.739222222274297*^9}, 
   3.7392224139773936`*^9, {3.739222581653812*^9, 3.739222594624098*^9}, {
   3.7392227797933645`*^9, 3.7392228142372255`*^9}, {3.7392229716785154`*^9, 
   3.7392229739813643`*^9}, {3.739223009778581*^9, 3.7392230115797615`*^9}, {
   3.739223559777153*^9, 3.739223564710943*^9}, {3.7392236906360555`*^9, 
   3.7392237176765137`*^9}, {3.739223902895378*^9, 3.7392239032663493`*^9}, {
   3.7392241914260902`*^9, 3.7392242242364073`*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"0d246342-a2cf-4109-818d-b8fec17e025b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"z", " ", "=", " ", 
   RowBox[{"buildNet", "[", 
    RowBox[{
    "tx", ",", " ", "ty", ",", " ", "b1", ",", " ", "b2", ",", " ", 
     "epsilon"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7391842745948677`*^9, 3.7391842776082344`*^9}, {
   3.73918458194786*^9, 3.739184583395079*^9}, {3.7391846795089464`*^9, 
   3.7391846828237514`*^9}, {3.739198483283041*^9, 3.7391984911051435`*^9}, 
   3.7391993751494813`*^9, 3.73922345321619*^9, {3.7392235739741774`*^9, 
   3.739223574618435*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"ef5ab3a2-1643-45ed-959d-84f47e0c95c2"],

Cell[CellGroupData[{

Cell[BoxData["0.10479408785269613`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224148618928*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"11ad44cb-9b79-4569-b598-b3ac7754ac2e"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224155467518*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"a0ed78ee-8393-4eed-8aad-3611f20da2a1"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224162324129*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"d75016b7-7bef-47ce-90b4-32089b0c74ac"]
}, Open  ]],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"2.5338233484061747`*^-234\\\", \\\" \\\", \
\\\"2.5338233484061747`*^-234\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,82,10,
   30264771395981210622,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7392232507847834`*^9, 3.739223457949527*^9, 
  3.739223576437567*^9, 3.739223784100749*^9, 3.739223993099803*^9, 
  3.739224167410557*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"32021a7d-19b5-47d4-9b4b-a2cbee088915"],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"1.519581811272032`*^-263\\\", \\\" \\\", \
\\\"1.519581811272032`*^-263\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,82,11,
   30264771395981210622,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7392232507847834`*^9, 3.739223457949527*^9, 
  3.739223576437567*^9, 3.739223784100749*^9, 3.739223993099803*^9, 
  3.739224168413389*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"f4c899fe-742c-43c6-8698-086cdacd4153"],

Cell[BoxData[
 TemplateBox[{
  "General","munfl",
   "\"\\!\\(\\*RowBox[{\\\"4.1025409304756453`*^-256\\\", \\\" \\\", \
\\\"4.1025409304756453`*^-256\\\"}]\\) is too small to represent as a \
normalized machine number; precision may be lost.\"",2,82,12,
   30264771395981210622,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7392232507847834`*^9, 3.739223457949527*^9, 
  3.739223576437567*^9, 3.739223784100749*^9, 3.739223993099803*^9, 
  3.739224169410228*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"0cca0139-da3f-44f3-b5c7-3695cc5c45eb"],

Cell[BoxData[
 TemplateBox[{
  "General","stop",
   "\"Further output of \\!\\(\\*StyleBox[RowBox[{\\\"General\\\", \
\\\"::\\\", \\\"munfl\\\"}], \\\"MessageName\\\"]\\) will be suppressed \
during this calculation.\"",2,82,13,30264771395981210622,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7392232507847834`*^9, 3.739223457949527*^9, 
  3.739223576437567*^9, 3.739223784100749*^9, 3.739223993099803*^9, 
  3.739224170184687*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"06c1a94d-b335-4c2e-a5f9-529901ce8bee"],

Cell[CellGroupData[{

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224173532398*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"4b577577-a943-44b6-8f27-a91a7496ddf4"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224180659978*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"2ab0a6b8-dba6-4e10-8d97-945423716b16"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.7392241879425974`*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"2cc0c9d6-33b7-4a05-beb3-82ce6870d794"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.7392241949278436`*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"5242cd90-c9d5-46dc-81e5-285b64f56915"],

Cell[BoxData["0.1`"], "Print",
 CellChangeTimes->{3.739223990235467*^9, 3.739224202404933*^9},
 CellLabel->
  "During evaluation of \
In[82]:=",ExpressionUUID->"ee732673-3a09-4ec5-aa1f-e0efb9b95787"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"runNet", "[", 
  RowBox[{"z", ",", " ", 
   RowBox[{"tx", "[", 
    RowBox[{"[", "422", "]"}], "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.739219653696536*^9, 3.739219660863119*^9}, {
   3.7392197027101164`*^9, 3.7392197697206182`*^9}, {3.7392198794692435`*^9, 
   3.739219881290923*^9}, {3.739220069843794*^9, 3.7392200715582075`*^9}, 
   3.739220632322547*^9, {3.739223415475165*^9, 3.7392234199272532`*^9}, {
   3.739223543429902*^9, 3.739223545565178*^9}, {3.739224069035647*^9, 
   3.7392240710402775`*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"aaa3dec1-28dc-4d1d-8085-2ad31190d2ca"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "7.857101552307249029311169690504`12.091711655561095*^-3168", ",", 
    "1.113536712947960786078358`11.929620659293837*^-4600", ",", 
    "8.25564137782783387095915797456971054824`11.932925379724168*^-4566", ",",
     "1.`", ",", "2.2824791220628663245250878`11.935256858437677*^-4541", ",",
     "1.362368363936164592818773548`11.912141423233503*^-4789", ",", 
    "2.8041853663014292346687531784636`12.051475241635233*^-3475", ",", 
    "2.3513426621968667822737841285386516`11.905860371689364*^-4859", ",", 
    "1.26215600380887451457101325918383`11.952897664090765*^-4360", ",", 
    "7.1333387380945122076683148681924862`11.930642139925135*^-4590"}], "}"}],
   "}"}]], "Output",
 CellChangeTimes->{{3.7392197271814065`*^9, 3.7392197700228157`*^9}, {
   3.7392198764096556`*^9, 3.739219881622035*^9}, {3.73922006303102*^9, 
   3.7392200721117277`*^9}, {3.739220625916686*^9, 3.739220632869088*^9}, 
   3.7392211246724625`*^9, {3.7392234058209925`*^9, 3.7392234202314377`*^9}, {
   3.7392235358770857`*^9, 3.739223546118684*^9}, {3.7392240661792836`*^9, 
   3.739224071344464*^9}},
 CellLabel->"Out[35]=",ExpressionUUID->"7d1586c5-7bfb-409f-ae77-6b7e0c1b57af"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ty", "[", 
  RowBox[{"[", "422", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7392197341690483`*^9, 3.7392197796269417`*^9}, {
  3.739223540467812*^9, 3.7392235406004477`*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"4bdc6864-3bc3-4b71-b0c9-2f7940eee5cb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
   "1", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0", 
    ",", "0", ",", "0"}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.7392197373078203`*^9, 3.739219779831328*^9}, 
   3.7392235411240463`*^9},
 CellLabel->"Out[80]=",ExpressionUUID->"4cc5859e-5242-4333-a856-3d23a73239d0"]
}, Open  ]]
},
WindowSize->{990, 1028},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"11.3 for Microsoft Windows (64-bit) (March 7, 2018)",
StyleDefinitions->"ReverseColor.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 3327, 71, 121, "Input",ExpressionUUID->"9ef69ac0-10de-4ab5-b332-39bce14ea535"],
Cell[3891, 93, 1668, 35, 209, "Input",ExpressionUUID->"e1a2b6d6-7ce8-4675-bec5-747d5309d469"],
Cell[5562, 130, 5382, 142, 385, "Input",ExpressionUUID->"a3942673-5bd5-4f48-b4fc-55dea3b9de20"],
Cell[10947, 274, 891, 22, 32, "Input",ExpressionUUID->"44e5af52-d1a2-46ee-82a9-0363e6f9e79e"],
Cell[11841, 298, 13995, 305, 803, "Input",ExpressionUUID->"0d246342-a2cf-4109-818d-b8fec17e025b"],
Cell[CellGroupData[{
Cell[25861, 607, 610, 12, 32, "Input",ExpressionUUID->"ef5ab3a2-1643-45ed-959d-84f47e0c95c2"],
Cell[CellGroupData[{
Cell[26496, 623, 215, 4, 23, "Print",ExpressionUUID->"11ad44cb-9b79-4569-b598-b3ac7754ac2e"],
Cell[26714, 629, 199, 4, 23, "Print",ExpressionUUID->"a0ed78ee-8393-4eed-8aad-3611f20da2a1"],
Cell[26916, 635, 199, 4, 23, "Print",ExpressionUUID->"d75016b7-7bef-47ce-90b4-32089b0c74ac"]
}, Open  ]],
Cell[27130, 642, 594, 13, 25, "Message",ExpressionUUID->"32021a7d-19b5-47d4-9b4b-a2cbee088915"],
Cell[27727, 657, 592, 13, 25, "Message",ExpressionUUID->"f4c899fe-742c-43c6-8698-086cdacd4153"],
Cell[28322, 672, 594, 13, 25, "Message",ExpressionUUID->"0cca0139-da3f-44f3-b5c7-3695cc5c45eb"],
Cell[28919, 687, 564, 12, 23, "Message",ExpressionUUID->"06c1a94d-b335-4c2e-a5f9-529901ce8bee"],
Cell[CellGroupData[{
Cell[29508, 703, 199, 4, 23, "Print",ExpressionUUID->"4b577577-a943-44b6-8f27-a91a7496ddf4"],
Cell[29710, 709, 199, 4, 23, "Print",ExpressionUUID->"2ab0a6b8-dba6-4e10-8d97-945423716b16"],
Cell[29912, 715, 201, 4, 23, "Print",ExpressionUUID->"2cc0c9d6-33b7-4a05-beb3-82ce6870d794"],
Cell[30116, 721, 201, 4, 23, "Print",ExpressionUUID->"5242cd90-c9d5-46dc-81e5-285b64f56915"],
Cell[30320, 727, 199, 4, 23, "Print",ExpressionUUID->"ee732673-3a09-4ec5-aa1f-e0efb9b95787"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[30568, 737, 619, 11, 32, "Input",ExpressionUUID->"aaa3dec1-28dc-4d1d-8085-2ad31190d2ca"],
Cell[31190, 750, 1224, 20, 91, "Output",ExpressionUUID->"7d1586c5-7bfb-409f-ae77-6b7e0c1b57af"]
}, Open  ]],
Cell[CellGroupData[{
Cell[32451, 775, 280, 5, 32, "Input",ExpressionUUID->"4bdc6864-3bc3-4b71-b0c9-2f7940eee5cb"],
Cell[32734, 782, 361, 8, 36, "Output",ExpressionUUID->"4cc5859e-5242-4333-a856-3d23a73239d0"]
}, Open  ]]
}
]
*)

